name: Test Dify Secrets

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    env:
      DIFY_BASE_URL: ${{ secrets.DIFY_BASE_URL }}
      DIFY_TOKENS: ${{ secrets.DIFY_TOKENS }}
      DIFY_INPUTS: ${{ secrets.DIFY_INPUTS }}
    steps:
      - name: æ£€æŸ¥ DIFY_BASE_URL
        run: |
          if [ -z "$DIFY_BASE_URL" ]; then
            echo "âŒ DIFY_BASE_URL æœªè®¾ç½®æˆ–ä¸ºç©º"
            exit 1
          else
            echo "âœ… DIFY_BASE_URL å·²åŠ è½½ï¼š$DIFY_BASE_URL"
          fi

      - name: æ£€æŸ¥ DIFY_TOKENS
        run: |
          if [ -z "$DIFY_TOKENS" ]; then
            echo "âŒ DIFY_TOKENS æœªè®¾ç½®æˆ–ä¸ºç©º"
            exit 1
          else
            echo "âœ… DIFY_TOKENS å·²åŠ è½½ï¼ˆå†…å®¹éšè—ï¼‰"
          fi

      - name: æ£€æŸ¥ DIFY_INPUTS
        run: |
          if [ -z "$DIFY_INPUTS" ]; then
            echo "âŒ DIFY_INPUTS æœªè®¾ç½®æˆ–ä¸ºç©º"
            exit 1
          else
            echo "âœ… DIFY_INPUTS å·²åŠ è½½ï¼š$DIFY_INPUTS"
          fi

      - name: è°ƒç”¨ Dify API è¿›è¡Œ Token éªŒè¯
        run: |
          echo "ğŸ” æ­£åœ¨è¯·æ±‚ Dify API: $DIFY_BASE_URL"
          response=$(curl -s -w "\nHTTP_STATUS:%{http_code}" \
            -H "Authorization: Bearer $DIFY_TOKENS" \
            -H "Content-Type: application/json" \
            "$DIFY_BASE_URL/v1/me")

          # æå– HTTP çŠ¶æ€ç 
          http_status=$(echo "$response" | sed -n 's/HTTP_STATUS://p')
          body=$(echo "$response" | sed '/HTTP_STATUS:/d')

          echo "è¿”å›çŠ¶æ€ç : $http_status"
          echo "è¿”å›å†…å®¹: $body"

          if [ "$http_status" -ne 200 ]; then
            echo "âŒ Dify API è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ DIFY_BASE_URL å’Œ DIFY_TOKENS"
            exit 1
          else
            echo "âœ… Dify API è¯·æ±‚æˆåŠŸï¼ŒToken æœ‰æ•ˆï¼"
          fi

      - name: æ‰€æœ‰æ£€æŸ¥é€šè¿‡
        run: echo "ğŸ‰ æ‰€æœ‰ Secrets ä¸ Token æµ‹è¯•å·²æˆåŠŸå®Œæˆï¼"
